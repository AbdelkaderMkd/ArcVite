import{aQ as r,aR as n,d2 as F,aT as P,aA as T,b9 as V}from"./index-383689b1.js";import{T as b,q as I}from"./rasterProjectionHelper-a0f6b67b.js";import{p as L}from"./popupUtils-98519cca.js";const O=R=>{let t=class extends R{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return this.projectFullExtent(this.view.spatialReference)}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return b(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(a){return!!this.projectFullExtent(a)}projectFullExtent(a){const u=this.layer.fullExtent,e=b(u,a,!1);return I(u,a,e)}async fetchPopupFeatures(a,u){const{layer:e}=this;if(!a)throw new T("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:h}=e,m=L(e,u);if(!h||m==null)throw new T("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:h,popupTemplate:m});const g=[],{value:o,magdirValue:l,processedValue:d}=await e.identify(a,{timeExtent:this.timeExtent});let p="";if(o&&o.length){p=e.type==="imagery-tile"&&e.hasStandardTime()&&o[0]!=null?o.map(y=>e.getStandardTimeValue(y)).join(", "):o.join(", ");const s={ObjectId:0},w="Raster.ServicePixelValue";s[w]=(d==null?void 0:d.join(", "))??p,s[w+".Raw"]=p;const x=e.rasterInfo.attributeTable;if(x!=null){const{fields:y,features:j}=x,v=y.find(({name:i})=>i.toLowerCase()==="value"),c=v?j.find(i=>String(i.attributes[v.name])===p):null;if(c)for(const i in c.attributes)c.attributes.hasOwnProperty(i)&&(s[this._rasterFieldPrefix+i]=c.attributes[i])}const E=e.rasterInfo.dataType;E!=="vector-magdir"&&E!=="vector-uv"||(s["Raster.Magnitude"]=l==null?void 0:l[0],s["Raster.Direction"]=l==null?void 0:l[1]);const f=new V(this.fullExtent.clone(),null,s);f.layer=e,f.sourceLayer=f.layer,g.push(f)}return g}};return r([n()],t.prototype,"layer",void 0),r([n(F)],t.prototype,"timeExtent",void 0),r([n()],t.prototype,"view",void 0),r([n()],t.prototype,"fullExtent",null),r([n()],t.prototype,"tileInfo",void 0),r([n({readOnly:!0})],t.prototype,"hasTilingEffects",null),r([n()],t.prototype,"datumTransformation",null),t=r([P("esri.views.layers.ImageryTileLayerView")],t),t};export{O as p};
