import{aQ as B,jq as x,jr as h,iQ as F,js as C,jt as E,ju as m,fq as N,gm as v,fd as $,cP as Q,iZ as d,jv as W,eo as S,e9 as D,jw as b,jx as H,jy as y,jz as I,jA as L,en as Z,jB as J,jC as K,jD as X,jE as Y,jF as k,jG as U,de as V,jH as nn,jI as en}from"./index-80114339.js";import{m as tn}from"./MeshGeoreferencedRelativeVertexSpace-b89241d7.js";import{m as rn,p as on}from"./MeshLocalVertexSpace-b04029c9.js";import{N as an}from"./MeshTransform-7efd4efa.js";function z(n,t){return n.isGeographic||n.isWebMercator&&((t==null?void 0:t.geographic)??!0)}function $n(n,t,e){const r=!n.isGeoreferenced;(e==null?void 0:e.geographic)!=null&&e.geographic!==r&&B.getLogger(t).warnOnce(`Specifying the 'geographic' parameter (${e.geographic}) for a Mesh vertex space of type "${n.type}" is not supported. This parameter will be ignored.`)}function w(n,t,e){return z(t.spatialReference,e)?fn(n,t,e):un(n,t,e)}function O(n,t,e,r){const{position:a,normal:o,tangent:i}=n;if(!t.isRelative)return{position:a,normal:o,tangent:i};const l=(e==null?void 0:e.localMatrix)??h;return w({position:m(new Float64Array(a.length),a,l),normal:o!=null?nn(o,new Float32Array(o.length),l):null,tangent:i!=null?en(i,new Float32Array(i.length),l):null},t.getOriginPoint(r),{geographic:!t.isGeoreferenced})}function sn(n,t,e){if(e!=null&&e.useTransform){const{position:r,normal:a,tangent:o}=n,{x:i,y:l,z:c}=t,s=D(i,l,c??0);return{vertexAttributes:{position:r,normal:a,tangent:o},vertexSpace:e.geographic??1?new rn({origin:s}):new tn({origin:s}),transform:new an}}return{vertexAttributes:w(n,t,e),vertexSpace:new on,transform:null}}function j(n,t,e){return z(t.spatialReference,e)?hn(n,t,e):T(n,t,e)}function ln(n,t,e,r,a){if(!t.isRelative)return j(n,r,a);const{spatialReference:o}=r,i=O(n,t,e,o);return r.equals(t.getOriginPoint(o))?T(i,r,a):j(i,r,a)}function cn({positions:n,transform:t,vertexSpace:e,inSpatialReference:r,outSpatialReference:a,outPositions:o,local:i}){const l=e.isRelative?e.origin:x,c=e.isRelative?(t==null?void 0:t.localMatrix)??h:h;if(e.isGeoreferenced){const u=o??F(n.length);if(C(c,h)?E(u,n):m(u,n,c),!N(l,x)){const[G,P,q]=l;for(let p=0;p<u.length;p+=3)u[p]+=G,u[p+1]+=P,u[p+2]+=q}return v(u,r,0,u,a,0,u.length/3),u}const s=$(r),R=!i&&Q(r,s)?s:r;d(r,l,f,R),W(f,f,c);const g=o??F(n.length);return m(g,n,f),v(g,R,0,g,a,0,g.length/3),g}function un(n,t,e){const r=new Float64Array(n.position.length),a=n.position,o=t.x,i=t.y,l=t.z??0,c=A(e?e.unit:null,t.spatialReference);for(let s=0;s<a.length;s+=3)r[s]=a[s]*c+o,r[s+1]=a[s+1]*c+i,r[s+2]=a[s+2]*c+l;return{position:r,normal:n.normal,tangent:n.tangent}}function fn(n,t,e){const r=t.spatialReference,a=M(t,e,f),o=new Float64Array(n.position.length),i=gn(n.position,a,r,o),l=b(_,a);return{position:i,normal:pn(i,o,n.normal,l,r),tangent:mn(i,o,n.tangent,l,r)}}function gn(n,t,e,r){m(r,n,t);const a=new Float64Array(n.length);return H(r,a,e)}function pn(n,t,e,r,a){if(e==null)return null;const o=new Float32Array(e.length);return y(o,e,r),I(o,n,t,a,o),o}function mn(n,t,e,r,a){if(e==null)return null;const o=new Float32Array(e.length);y(o,e,r,4);for(let i=3;i<o.length;i+=4)o[i]=e[i];return L(o,n,t,a,o),o}function T(n,t,e){const r=new Float64Array(n.position.length),a=n.position,o=t.x,i=t.y,l=t.z??0,c=A(e?e.unit:null,t.spatialReference);for(let s=0;s<a.length;s+=3)r[s]=(a[s]-o)/c,r[s+1]=(a[s+1]-i)/c,r[s+2]=(a[s+2]-l)/c;return{position:r,normal:n.normal,tangent:n.tangent}}function hn(n,t,e){const r=t.spatialReference;M(t,e,f);const a=Z(An,f),o=new Float64Array(n.position.length),i=yn(n.position,r,a,o),l=b(_,a);return{position:i,normal:jn(n.normal,n.position,o,r,l),tangent:wn(n.tangent,n.position,o,r,l)}}function M(n,t,e){d(n.spatialReference,[n.x,n.y,n.z??0],e,$(n.spatialReference));const r=A(t?t.unit:null,n.spatialReference);return J(e,e,[r,r,r]),e}function yn(n,t,e,r){const a=K(n,t,r),o=new Float64Array(a.length);return m(o,a,e),o}function jn(n,t,e,r,a){if(n==null)return null;const o=X(n,t,e,r,new Float32Array(n.length));return y(o,o,a),o}function wn(n,t,e,r,a){if(n==null)return null;const o=Y(n,t,e,r,new Float32Array(n.length));return y(o,o,a,4),o}function A(n,t){if(n==null)return 1;const e=k(t);return 1/U(e,"meters",n)}const f=S(),An=S(),_=V(),dn=Object.freeze(Object.defineProperty({__proto__:null,georeference:w,georeferenceApplyTransform:O,georeferenceByTransform:sn,project:cn,ungeoreference:j,ungeoreferenceByTransform:ln},Symbol.toStringTag,{value:"Module"}));export{j as D,ln as E,cn as I,w as O,O as T,dn as g,$n as o,sn as q,z as r};
