import{aW as h,b2 as w,dO as T,bY as d,dP as y,ci as _,cd as g,aA as k,dQ as F,aQ as r,aR as u,aT as v,dR as $,dS as E,c2 as P,dT as x,dM as A,dU as p,cE as O}from"./index-383689b1.js";let o=class extends h{constructor(){super({}),this._uploadTask=null}destroy(){this.cancel()}get state(){const e=this._uploadTask;return e?e.finished?e.error?w(e.error)?"canceled":"error":"success":"pending":"default"}get result(){var e;return((e=this._uploadTask)==null?void 0:e.value)??null}get error(){var e;return((e=this._uploadTask)==null?void 0:e.error)??null}uploadTo(e){this.cancel(),this._uploadTask=T(async t=>{const s=await R(e);if(d(t),s.length===0)throw y();const a=(await _(()=>import("./Mesh-4fae1347.js"),["assets/Mesh-4fae1347.js","assets/index-383689b1.js","assets/index-90fc0cd1.css","assets/MeshGeoreferencedRelativeVertexSpace-be9e8612.js","assets/MeshLocalVertexSpace-c545ba83.js","assets/MeshTransform-1edc7c1e.js","assets/georeference-104df20c.js","assets/External-ad35fd1c.js"])).default;d(t);const i=new g({x:0,y:0,z:0,spatialReference:e.spatialReference}),n=await a.createFromFiles(i,s,{layer:e,signal:t});if(d(t),!n)throw new k("editor:upload","could not upload or convert model");return n.load()})}cancel(){this._uploadTask=F(this._uploadTask)}};r([u()],o.prototype,"state",null),r([u()],o.prototype,"result",null),r([u()],o.prototype,"error",null),r([u()],o.prototype,"_uploadTask",void 0),o=r([v("esri.widgets.Editor.Upload")],o);let l=null;async function R(e){return"showOpenFilePicker"in window&&!l?D(e):b(e)}async function D(e){try{const t=await window.showOpenFilePicker({multiple:!0,excludeAcceptAllOption:!0,types:$(e.infoFor3D)});return Promise.all(t.map(s=>s.getFile()))}catch(t){return E(t),[]}}async function b(e){const t=P();let s;const a=document.createElement("input");a.type="file",a.multiple=!0,a.accept=x(e.infoFor3D).join(",");const i=A([p(a,"change",()=>f(n())),O(()=>clearTimeout(s)),p(document,["focus","focusin"],m),p(window,["focus","focusin"],m)]);function n(){return a.files?Array.from(a.files):[]}function f(c){i.remove(),t.resolve(c)}function m(){clearTimeout(s),s=setTimeout(()=>{if(!document.hasFocus())return;const c=n();c.length===0&&f(c)},S)}return l?l(a):a.click(),t.promise.finally(()=>i.remove())}function j(e){l=t=>{setTimeout(()=>{const s=new DataTransfer;e.forEach(a=>s.items.add(a)),t.files=s.files,t.dispatchEvent(new Event("change"))})}}function Q(){l=null}const S=5e3;export{o as Upload,Q as clearPromptForFilesStub,j as simulateSelectingFiles};
