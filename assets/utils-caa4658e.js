import{oF as E,bK as b,fB as I,oG as x,oH as C,bU as f,oI as $,aQ as V,oJ as p,oK as B,eb as M}from"./index-80114339.js";const N=/^-?(\d+)(\.(\d+))?$/i;function U(t,e){return t-e}function O(t,e){let o,a;return o=Number(t.toFixed(e)),o<t?a=o+1/10**e:(a=o,o-=1/10**e),o=Number(o.toFixed(e)),a=Number(a.toFixed(e)),[o,a]}function R(t,e,o,a,n){const l=_(t,e,o,a),i=l.previous==null||l.previous<=n,r=l.next==null||l.next<=n;return i&&r||l.previous+l.next<=2*n}function v(t){const e=String(t),o=e.match(N);if(o&&o[1])return{integer:o[1].split("").length,fractional:o[3]?o[3].split("").length:0};if(e.toLowerCase().includes("e")){const a=e.split("e"),n=a[0],l=a[1];if(n&&l){const i=Number(n);let r=Number(l);const u=r>0;u||(r=Math.abs(r));const s=v(i);return u?(s.integer+=r,r>s.fractional?s.fractional=0:s.fractional-=r):(s.fractional+=r,r>s.integer?s.integer=1:s.integer-=r),s}}return{integer:0,fractional:0}}function _(t,e,o,a){const n={previous:null,next:null};if(o!=null){const l=t-o,i=e-o-l;n.previous=Math.floor(Math.abs(100*i/l))}if(a!=null){const l=a-t,i=a-e-l;n.next=Math.floor(Math.abs(100*i/l))}return n}function X(t,e={}){const o=t.slice(0),{tolerance:a=2,strictBounds:n=!1,indexes:l=o.map((i,r)=>r)}=e;l.sort(U);for(let i=0;i<l.length;i++){const r=l[i],u=o[r],s=r===0?null:o[r-1],A=r===o.length-1?null:o[r+1],m=v(u).fractional;if(m){let g,h=0,w=!1;for(;h<=m&&!w;){const d=O(u,h);g=n&&i===0?d[1]:d[0],w=R(u,g,s,A,a),h++}w&&(o[r]=g)}}return o}const Q={maximumFractionDigits:20};function S(t){return E(t,Q)}const q="<",k=">",K=C("short-date");function j(t,e,o,a){let n="";e===0?n=`${q} `:e===o&&(n=`${k} `);let l=null;return l=a?x(t,K):S(t),n+l}const Y=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function F(t){if(!("visualVariables"in t)||!t.visualVariables)return null;const e=t.visualVariables.find(i=>i.type==="color");if(!e)return null;let o=null,a=null;if(e.stops){if(e.stops.length===1)return e.stops[0].color;o=e.stops[0].value,a=e.stops[e.stops.length-1].value}const n=o!=null&&a!=null?o+(a-o)/2:0,{getColor:l}=await b(()=>import("./index-80114339.js").then(i=>i.Am),["assets/index-80114339.js","assets/index-e81f504d.css"]);return l(e,n)??null}async function J(t,e){const o=t.trailCap,a=t.trailWidth||1,n=e||await F(t)||t.color;return new I({cap:o,color:n,width:a})}function z(t){return t!=null&&typeof t=="object"&&"min"in t&&"max"in t}const G=new f([64,64,64]);function y(t,e){const o=[],a=t.length-1;return t.length===5?o.push(0,2,4):o.push(0,a),t.map((n,l)=>o.includes(l)?j(n,l,a,e):null)}async function L(t,e,o){let a=!1,n=[],l=[];if(t.stops){const s=t.stops;n=s.map(A=>A.value),a=s.some(A=>!!A.label),a&&(l=s.map(A=>A.label))}const i=n[0],r=n[n.length-1];if(i==null&&r==null)return null;const u=a?null:y(n,o??!1);return(await Promise.all(n.map(async(s,A)=>({value:s,color:t.type==="opacity"?await W(s,t,e):(await b(()=>import("./index-80114339.js").then(m=>m.Am),["assets/index-80114339.js","assets/index-e81f504d.css"])).getColor(t,s),label:a?l[A]:(u==null?void 0:u[A])??""})))).reverse()}async function W(t,e,o){const a=new f(o??G),n=(await b(()=>import("./index-80114339.js").then(l=>l.Am),["assets/index-80114339.js","assets/index-e81f504d.css"])).getOpacity(e,t);return n!=null&&(a.a=n),a}function Z(t){let e=!1,o=[],a=[];o=t.map(r=>r.value),e=t.some(r=>!!r.label),e&&(a=t.map(r=>r.label??""));const n=o[0],l=o[o.length-1];if(n==null&&l==null)return null;const i=e?null:y(o,!1);return o.map((r,u)=>({value:r,color:H(r,t),label:e?a[u]:(i==null?void 0:i[u])??""})).reverse()}function H(t,e){const{startIndex:o,endIndex:a,weight:n}=P(t,e);if(o===a)return e[o].color;const l=f.blendColors(e[o].color,e[a].color,n);return new f(l)}function P(t,e){let o=0,a=e.length-1;return e.some((n,l)=>t<n.value?(a=l,!0):(o=l,!1)),{startIndex:o,endIndex:a,weight:(t-e[o].value)/(e[a].value-e[o].value)}}function tt(t,e){let o=[];if(t&&t.type==="multipart")t.colorRamps.reverse().forEach((a,n)=>{n===0?o.push({value:e.max,color:new f(a.toColor),label:"high"}):o.push({value:null,color:new f(a.toColor),label:""}),n===t.colorRamps.length-1?o.push({value:e.min,color:new f(a.fromColor),label:"low"}):o.push({value:null,color:new f(a.fromColor),label:""})});else{let a,n;t&&t.type==="algorithmic"?(a=t.fromColor,n=t.toColor):(a=[0,0,0,1],n=[255,255,255,1]),o=[{value:e.max,color:new f(n),label:"high"},{value:e.min,color:new f(a),label:"low"}]}return o}function D(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(a=>{var n;return((n=a.color)==null?void 0:n.a)>0});let o=e.length-1;if(e&&e[0]){const a=e[o];a&&a.ratio!==1&&(e.push(new $({ratio:1,color:a.color})),o++)}return e.map((a,n)=>{var i,r;let l="";return n===0?l=((i=t.legendOptions)==null?void 0:i.minLabel)||"low":n===o&&(l=((r=t.legendOptions)==null?void 0:r.maxLabel)||"high"),{color:a.color,label:l,ratio:a.ratio}}).reverse()}V.getLogger("esri.renderers.support.utils");async function c(t,e,o){M(t,e,()=>[]).push(...o)}async function et(t){var o,a;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){const n=t.visualVariables.filter(l=>l.type==="color");for(const l of n){const i=(await L(l)??[]).map(r=>r.color);await c(e,l.field||l.valueExpression,i)}}if(t.type==="heatmap"){const n=D(t).map(l=>l.color);await c(e,t.field||t.valueExpression,n)}else if(t.type==="pie-chart"){for(const n of t.attributes)await c(e,n.field||n.valueExpression,[n.color]);await c(e,"default",[(o=t==null?void 0:t.othersCategory)==null?void 0:o.color,p(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const n of t.attributes)await c(e,n.field||n.valueExpression,[n.color]);await c(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((a=t.authoringInfo)==null?void 0:a.type)==="predominance")for(const n of t.uniqueValueInfos??[])await c(e,n.value.toString(),[p(n.symbol,null)]);else{const n=(t.uniqueValueInfos??[]).map(s=>p(s.symbol,null)),{field:l,field2:i,field3:r,valueExpression:u}=t;(l||u)&&await c(e,l||u,n),i&&await c(e,i,n),r&&await c(e,r,n)}else if(t.type==="class-breaks"){const n=t.classBreakInfos.map(r=>p(r.symbol,null)),{field:l,valueExpression:i}=t;await c(e,l??i,n)}else t.type==="simple"&&await c(e,"default",[p(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await c(e,"default",[p(t.defaultSymbol,null)]),e.forEach((n,l)=>{const i=B(n.filter(Boolean),(r,u)=>JSON.stringify(r)===JSON.stringify(u));e.set(l,i)}),e}export{J as a,q as b,H as c,Z as d,tt as e,F as f,L as g,et as h,v as i,_ as l,j as n,k as o,z as p,D as r,Y as s,X as u};
