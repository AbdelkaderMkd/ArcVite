import{e8 as rt,nu as it,aA as x,aB as G,hE as Re,cn as nt,jR as ve,jS as Ne,aD as ot,dR as at,bU as b,a_ as ct,oS as re,m7 as lt,m8 as dt,eJ as Pe,ma as Se,qu as Ue,me as ut,ml as gt,bK as ht,mn as pt,mo as ft,mp as bt,mq as mt,rf as _t,ih as K,ir as $t,mw as Tt,rg as wt,no as ie,mB as Ot,rh as At,mD as Ct,mE as Et,lD as It,lE as Rt,qD as vt,nn as _,np as Le,iO as Nt,qL as de,pj as Pt,nf as c,hJ as U,pr as Fe,po as L,d6 as ne,jd as f,jc as p,ri as Oe,pD as Z,jB as Xe,jv as Y,rj as ze,ne as w,qY as Ye,ns as z,qT as v,dd as oe,eV as M,rk as St,e9 as S,nq as Q,mk as ee,nr as Ut,qX as Me,rl as ye,eo as fe,hI as Ve,rm as ke,rn as xe,ro as We,rp as Lt,rq as Ze,pt as B,eU as N,pB as Mt,rr as yt,rs as me,rt as Vt,ru as kt,eh as xt,f4 as Wt,nZ as Gt,lK as Je,fl as Bt,pw as Ke,rv as _e,rw as Ge,pz as jt,rx as Ht,aQ as Dt}from"./index-80114339.js";import{g as X}from"./persistable-4d832adc.js";import{i as j,u as Qe}from"./analysisThemeUtils-a0e02cce.js";import{b as qt,u as Ft,r as Xt}from"./LineVisualElement-1f3dfbfa.js";import{N as zt,$ as et,e as C,U as Yt,R as Zt}from"./manipulatorUtils-57bcc9f4.js";let O=class extends rt(at){constructor(t){super(t),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(t){return this.heading===t.heading&&this.tilt===t.tilt&&it(this.position,t.position)&&this.width===t.width&&this.height===t.height}};x([G({readOnly:!0,json:{read:!1,write:!0}})],O.prototype,"type",void 0),x([G({type:nt}),X()],O.prototype,"position",void 0),x([G({type:Number,nonNullable:!0,range:{min:0,max:360}}),X(),Re(e=>ve.normalize(Ne(e),0,!0))],O.prototype,"heading",void 0),x([G({type:Number,nonNullable:!0,range:{min:0,max:360}}),X(),Re(e=>ve.normalize(Ne(e),0,!0))],O.prototype,"tilt",void 0),x([G({type:Number,nonNullable:!0}),X()],O.prototype,"width",void 0),x([G({type:Number,nonNullable:!0}),X()],O.prototype,"height",void 0),O=x([ot("esri.analysis.SlicePlane")],O);const Jt=O;let Kt=class{constructor(){this.color=j()}},Qt=class{constructor(){this.color=new b([0,0,0,.04]),this.gridColor=j(.5),this.outlineColor=j(.7)}},es=class{constructor(){this.color=j()}},ts=class{constructor(){this.color=j(.5),this.contrastColor=Qe()}},ss=class{constructor(){this.color=Qe(),this.outlineColor=j()}},rs=class{constructor(){this.callouts=new Kt,this.plane=new Qt,this.resizeManipulators=new es,this.rotateManipulators=new ts,this.shiftManipulator=new ss}},ae=new rs;const Hs=ct("mac")?"Meta":"Control",Ds="Shift",is=2,ns=1.15,os=1.15,qs=2500,Fs=.02,as=Math.cos(re(45)),Be=Math.cos(re(5)),Xs=.95,zs=.3,Ys=2,cs=1,ls=3,tt=11,$e=22.5,se=40,je=48,ds=2.25,us=4,He=1,gs=.3,hs=6,ps=4,De=1600,fs=.4;function bs(e){const t=new lt,{vertex:r,fragment:s,attributes:n,varyings:o}=t;return dt(r,e),n.add(Pe.POSITION,"vec3"),n.add(Pe.UV0,"vec2"),o.add("vUV","vec2"),r.code.add(Se`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),s.uniforms.add(new Ue("backgroundColor",i=>i.backgroundColor),new Ue("gridColor",i=>i.gridColor),new ut("gridWidth",i=>i.gridWidth)),s.code.add(Se`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const ms=Object.freeze(Object.defineProperty({__proto__:null,build:bs},Symbol.toStringTag,{value:"Module"}));class _s extends wt{constructor(){super(...arguments),this.backgroundColor=ie(1,0,0,.5),this.gridColor=ie(0,1,0,.5),this.gridWidth=4}}class ue extends pt{initializeProgram(t){return new ft(t.rctx,ue.shader.get().build(this.configuration),bt)}initializePipeline(){return mt({blending:_t(K.ONE,K.ONE,K.ONE_MINUS_SRC_ALPHA,K.ONE_MINUS_SRC_ALPHA),depthTest:{func:$t.LESS},colorWrite:Tt})}}ue.shader=new gt(ms,()=>ht(()=>import("./SlicePlaneMaterial.glsl-ab167ff6.js"),["assets/SlicePlaneMaterial.glsl-ab167ff6.js","assets/index-80114339.js","assets/index-e81f504d.css","assets/persistable-4d832adc.js","assets/resourceExtension-3e0f8cd8.js","assets/analysisThemeUtils-a0e02cce.js","assets/colorUtils-f82202df.js","assets/LineVisualElement-1f3dfbfa.js","assets/manipulatorUtils-57bcc9f4.js","assets/ImageMaterial-379bb586.js"]));class $s extends Ot{constructor(t){super(t,new ws),this._configuration=new At}createBufferWriter(){return new Ct(Et)}requiresSlot(t,r){return r===It.Color&&t===Rt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(t){return new Ts(t)}getConfiguration(){return this._configuration}}class Ts extends vt{constructor(t){super(t),this.ensureTechnique(ue,null)}beginSlot(){return this.technique}}class ws extends _s{constructor(){super(...arguments),this.renderOccluded=_.Occlude}}class Os extends qt{constructor(t){super(t),this._material=null,this._renderOccluded=_.OccludeAndTransparent,this._gridWidth=1,this._gridColor=ie(1,0,0,1),this._backgroundColor=ie(1,0,0,1),this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){Le(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){Le(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new $s(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){this._material!=null&&t(this._material)}createGeometries(t){if(this._material!=null){const r=Nt(this._material);t.addGeometry(r)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){this._material!=null&&this._material.setParameters(this._materialParameters)}}function Zs(e,t,r,s,n,o,i,a){return As(t,i.worldUpAtPosition(e,c.get()),n,o,a.basis1,a.basis2),p(a.basis1,a.basis1,r),p(a.basis2,a.basis2,s),U(a.origin,e),Ze(a.basis2,a.basis1,a.origin,a.plane),a}function As(e,t,r,s,n,o){const i=B(e,t),a=c.get(),d=c.get();switch(s===P.HORIZONTAL_OR_VERTICAL?Math.abs(i)>as?P.HORIZONTAL:P.VERTICAL:s){case P.VERTICAL:{const h=Math.abs(i)<=Be?e:r.viewUp;N(a,h,t),U(d,t);break}case P.HORIZONTAL:N(a,r.viewUp,t),N(d,t,a);break;case P.TILTED:{const h=Math.abs(i)<=Be?t:r.viewUp;N(a,h,e),N(d,e,a);break}}const g=N(c.get(),a,d);B(g,r.viewForward)>0&&p(d,d,-1),M(n,a),M(o,d)}function Cs(e,t,r){const s=t.worldUpAtPosition(e.origin,c.get()),n=e.basis1,o=Ee(e,s),i=Math.round(o/H)*H;return _e(e,i-o,n,r)}function Js(e,t,r,s,n,o){const i=U(c.get(),n.origin);f(i,i,p(c.get(),n.basis1,e.direction[0]<0?1:-1)),f(i,i,p(c.get(),n.basis2,e.direction[1]<0?1:-1));const a=L(n.basis1),d=L(n.basis2),g=w(c.get(),r,i),h=w(c.get(),t,i);let u=0,l=0;if(Ce(e)){const T=Te(n),ge=Te(o);u=a-.5*e.direction[0]*B(n.basis1,h)/a,l=d-.5*e.direction[1]*B(n.basis2,h)/d;const D=ge/T;u*=D,l*=D}const $=u+.5*e.direction[0]*B(n.basis1,g)/a,m=l+.5*e.direction[1]*B(n.basis2,g)/d,y=p(c.get(),n.basis1,$/a),I=p(c.get(),n.basis2,m/d);($<=0||qe(o.origin,y,s)<=De)&&U(y,o.basis1),(m<=0||qe(o.origin,I,s)<=De)&&U(I,o.basis2);const R=U(c.get(),i);return f(R,R,p(c.get(),y,e.direction[0]<0?-1:1)),f(R,R,p(c.get(),I,e.direction[1]<0?-1:1)),Mt(R,y,I,o)}function Ks(e,t){return fs*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function Qs(e,t,r,s){const n=N(c.get(),t,r);return N(n,n,t),Fe(e,n,s)}function er(e,t){return zt(e.basis1,e.basis2,e.origin,t)}function tr(e,t,r,s){const n=t.worldUpAtPosition(e.origin,c.get()),o=c.get();switch(r){case ce.HEADING:U(o,n);break;case ce.TILT:U(o,e.basis1)}return Fe(e.origin,o,s)}function sr(e,t,r,s){const n=Ae(r,E.NEGATIVE_X),o=Z.get();yt(o,t,n.edge*Math.PI/2);const i=M(c.get(),n.basis);let a=p(c.get(),i,n.direction*s.computeScreenPixelSizeAt(n.position)*se);f(a,a,n.position);const d=s.projectToRenderScreen(a,me(c.get())),g=Es(s,d);Vt(s,d,te),M(te.direction,te.direction);const h=c.get();!g&&kt(r,te,h)&&(a=h),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=xt(a),g?e.state|=le:e.state&=~le}function Es(e,t){const[r,s,n,o]=e.viewport,i=Math.min(n,o)/16;let a=!0;return t[0]<r+i?(t[0]=r+i,a=!1):t[0]>r+n-i&&(t[0]=r+n-i,a=!1),t[1]<s+i?(t[1]=s+i,a=!1):t[1]>s+o-i&&(t[1]=s+o-i,a=!1),a}function rr(e,t,r,s){const n=L(s.basis1),o=L(s.basis2),i=st(s),a=Te(s),d=ne(c.get(),0,0,0);f(d,p(c.get(),s.basis1,t.direction[0]),p(c.get(),s.basis2,t.direction[1])),f(d,s.origin,d);let g=0,h=1;if(Ce(t))t.direction[0]===1&&t.direction[1]===-1?g=H:t.direction[0]===1&&t.direction[1]===1?g=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(g=3*Math.PI/2),h=a;else{const l=t.direction[0]!==0?1:2;g=l===1?H:0,h=(l===1?o:n)-i}const u=Oe(Z.get(),g);Xe(u,u,ne(c.get(),h,h,h)),Y(u,r,u),u[12]=0,u[13]=0,u[14]=0,e.modelTransform=u,e.renderLocation=d}function ir(e,t,r,s){const n=s.worldUpAtPosition(r.origin,c.get()),o=Ae(r,E.POSITIVE_X),i=Oe(Z.get(),o.edge*Math.PI/2);ze(i,i,-Ee(r,n)),Y(i,t,i),i[12]=0,i[13]=0,i[14]=0,e.modelTransform=i,e.renderLocation=o.position}function nr(e,t,r){const s=Ae(r,E.POSITIVE_Y),n=Oe(Z.get(),s.edge*Math.PI/2);ze(n,n,H),Y(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=s.position}var E;function Ae(e,t){switch(t){case E.POSITIVE_X:return{basis:e.basis1,direction:1,position:f(c.get(),e.origin,e.basis1),edge:t};case E.POSITIVE_Y:return{basis:e.basis2,direction:1,position:f(c.get(),e.origin,e.basis2),edge:t};case E.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:w(c.get(),e.origin,e.basis1),edge:t};case E.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:w(c.get(),e.origin,e.basis2),edge:t}}}function qe(e,t,r){const s=r.projectToRenderScreen(f(c.get(),e,t),me(c.get())),n=r.projectToRenderScreen(w(c.get(),e,t),me(c.get()));return Wt(w(s,s,n))}function st(e){const t=L(e.basis1),r=L(e.basis2);return gs*Math.min(t,r)}function Te(e){return st(e)}function Ce(e){return e.direction[0]!==0&&e.direction[1]!==0}function or(e,t){const r=t.offsetMode===we.CENTER_ON_CALLOUT?se:0,s=[S(r,0,-je/2),S(r,0,je/2)],n=vs(s,!0),o=(u,l)=>Is(s,u,l,t),i=o(0,!1),a=o(ds,!0),d=new Ye({color:b.toUnitRGBA(t.calloutColor),renderOccluded:_.OccludeAndTransparent}),g=z(d,[[r,0,0],[r-se,0,0]]),h=z(d,[[r,0,0],[r-se,0,0]]);return new et({view:e,renderObjects:[...i.normal.map(u=>new C(u,v.Unfocused|A)),...a.normal.map(u=>new C(u,v.Unfocused|A)),new C(g,v.Unfocused|A|le),...i.focused.map(u=>new C(u,v.Focused|A)),...a.focused.map(u=>new C(u,v.Focused|A)),new C(h,v.Focused|A|le)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:tt,state:A})}function ar(e,t){const r=Zt(e,{calloutColor:b.toUnitRGBA(ae.callouts.color),customStateMask:A,texture:t});return r.state=A,r}function cr(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new Ft({view:e,attached:!1,color:b.toUnitRGBA(ae.plane.outlineColor),width:cs,renderOccluded:_.OccludeAndTransparent,geometry:[t]})}function lr(e){return new Os({view:e,attached:!1,backgroundColor:b.toUnitRGBA(ae.plane.color),gridColor:b.toUnitRGBA(ae.plane.gridColor),gridWidth:4,renderOccluded:_.OccludeAndTransparent})}function dr(e,t,r){const s=Ce(t),n=s?[S(1,0,0),S(0,0,0),S(0,1,0)]:[S(1,0,0),S(-1,0,0)],o=b.toUnitRGBA(r.color),i=m=>new Ut({color:o,width:m,renderOccluded:_.OccludeAndTransparent}),a=()=>new Ye({color:o,renderOccluded:_.OccludeAndTransparent}),d=s?us:He,g=d*is,h=He,u=m=>m>1?i(m):a(),l=[new C(z(u(d),n),v.Unfocused|be),new C(z(u(g),n),v.Focused|be),new C(z(u(h),n),Ps)],$=new et({view:e,renderObjects:l,collisionType:{type:"line",paths:[n]},radius:s?hs:ps,...Yt});return $.state=be,$}function Is(e,t,r,s){const n=b.blendColors(s.color,s.outlineColor,.4),o=b.blendColors(s.color,s.outlineColor,.14),i=new Q({color:b.toUnitRGBA(s.color),cullFace:ee.Back,renderOccluded:_.Opaque}),a=new Q({color:b.toUnitRGBA(n),cullFace:ee.Back,renderOccluded:_.Opaque}),d=new Q({color:b.toUnitRGBA(o),cullFace:ee.Back,renderOccluded:_.Opaque}),g=new Q({color:b.toUnitRGBA(s.outlineColor),transparent:!0,writeDepth:!1,cullFace:ee.Front,renderOccluded:_.Transparent}),h=u=>{const l=e.slice(0),$=w(c.get(),l[0],l[1]);M($,$);const m=w(c.get(),l[l.length-1],l[l.length-2]);if(M(m,m),t>0){const F=p(oe(),m,-t);l[l.length-1]=f(F,F,l[l.length-1]);const W=p(oe(),$,-t);l[0]=f(W,W,l[0])}const y=u?os:1,I=$e*y,R=tt*y,T=Me(Z.get());if(t>0){const F=I/4,W=ne(c.get(),0,F,0),J=1+t/F;ye(T,T,W),Xe(T,T,ne(c.get(),J,J,J)),ye(T,T,p(W,W,-1/J))}const ge=Me(fe()),D=S(0,1,0),V=Ve(fe(),ke(xe.get(),D,m));V[12]=l[l.length-1][0],V[13]=l[l.length-1][1],V[14]=l[l.length-1][2],Y(V,V,T);const Ie=Rs(ls*(u?ns:1)+t,l,r?g:d);Ie.transformation=ge;const q=[Ie],he=We(r?g:i,I,R,24,!1,!1,!0);he.transformation=V,q.push(he);const pe=We(r?g:a,I,R,24,!1,!0,!1);pe.transformation=V,q.push(pe);const k=Ve(fe(),ke(xe.get(),D,$));return k[12]=l[0][0],k[13]=l[0][1],k[14]=l[0][2],Y(k,k,T),q.push(he.instantiate({transformation:k})),q.push(pe.instantiate({transformation:k})),q};return{normal:h(!1),focused:h(!0)}}function Rs(e,t,r){const s=[];for(let o=0;o<12;o++){const i=o/12*2*Math.PI;s.push([Math.cos(i)*e,Math.sin(i)*e])}return Lt(r,s,t,[],[],!1)}function vs(e,t){const r=w(oe(),e[e.length-1],e[e.length-2]);if(M(r,r),p(r,r,$e),f(r,r,e[e.length-1]),t){const s=w(oe(),e[0],e[1]);return M(s,s),p(s,s,$e),f(s,s,e[0]),[s,...e,r]}return[...e,r]}function ur(e,t,r,s=new Jt){if(e==null)return null;const{renderCoordsHelper:n}=t,o=n.fromRenderCoords(e.origin,t.spatialReference);if(o==null)return null;const i=Gt(o,r);if(i==null)return null;s.position=i;const a=2*L(e.basis1),d=2*L(e.basis2),g=Je.renderUnitScaleFactor(t.spatialReference,r);s.width=a*g,s.height=d*g;const h=n.worldUpAtPosition(e.origin,c.get());return s.tilt=Bt(Ee(e,h)),s.heading=n.headingAtPosition(e.origin,e.basis1)-90,s}function Ee(e,t){return St(t,e.basis2,e.basis1)+H}function Ns(e,t,r,s,n,o,i=Ke()){return o.toRenderCoords(e,i.origin)?(o.worldBasisAtPosition(i.origin,Ge.X,i.basis1),o.worldBasisAtPosition(i.origin,Ge.Y,i.basis2),Ze(i.basis2,i.basis1,i.origin,i.plane),_e(i,-re(t),jt(i),i),_e(i,re(r),i.basis1,i),p(i.basis1,i.basis1,s/2),p(i.basis2,i.basis2,n/2),Ht(i),i):(Dt.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function gr(e,t){if(e==null||e.position==null)return null;const r=Xt(e.position,t.spatialReference,t.elevationProvider);if(r==null)return null;const s=Je.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),n=e.width*s,o=e.height*s;return{position:r,heading:e.heading,tilt:e.tilt,renderWidth:n,renderHeight:o}}function hr(e,t,r,s=Ke()){if(e==null)return null;const n=Ns(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,s);return r.tiltEnabled||n==null||Cs(n,t.renderCoordsHelper,n),n}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(E||(E={}));const A=de.Custom1;var ce,P;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(ce||(ce={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(P||(P={}));const le=de.Custom2,te=Pt(),H=Math.PI/2,be=de.Custom1,Ps=de.Custom2;var we;function pr(e){return(e.type==="building-scene-3d"?e:null)!=null}(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(we||(we={}));export{Ce as $,pr as A,sr as B,nr as D,rr as F,Qs as G,tr as H,or as J,ar as K,Ys as M,we as O,cr as Q,Ks as S,be as T,ir as X,ae as a,lr as b,Ds as c,hr as d,dr as e,Hs as f,zs as g,Jt as h,P as i,A as j,er as k,gr as l,qs as m,Xs as n,Fs as o,ce as p,cs as q,ur as r,le as s,bs as t,Zs as v,Ps as w,Js as y,Te as z};
