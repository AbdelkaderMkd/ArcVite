import{aw as C,jG as x,jH as h,j5 as F,jI as W,jJ as B,i7 as m,fM as K,gC as v,fz as $,dj as L,je as d,jK as q,eO as O,ce as E,jL as S,jM as H,jN as y,jO as I,jP as J,eN as Q,jQ as D,jR as U,jS as V,jT as X,ib as Y,jU as Z,dK as k,jV as nn,jW as en}from"./index-383689b1.js";import{m as tn}from"./MeshGeoreferencedRelativeVertexSpace-be9e8612.js";import{m as rn,p as on}from"./MeshLocalVertexSpace-c545ba83.js";import{N as an}from"./MeshTransform-1edc7c1e.js";function b(n,t){return n.isGeographic||n.isWebMercator&&((t==null?void 0:t.geographic)??!0)}function $n(n,t,e){const r=!n.isGeoreferenced;(e==null?void 0:e.geographic)!=null&&e.geographic!==r&&C.getLogger(t).warnOnce(`Specifying the 'geographic' parameter (${e.geographic}) for a Mesh vertex space of type "${n.type}" is not supported. This parameter will be ignored.`)}function w(n,t,e){return b(t.spatialReference,e)?fn(n,t,e):un(n,t,e)}function M(n,t,e,r){const{position:a,normal:o,tangent:i}=n;if(!t.isRelative)return{position:a,normal:o,tangent:i};const l=(e==null?void 0:e.localMatrix)??h;return w({position:m(new Float64Array(a.length),a,l),normal:o!=null?nn(o,new Float32Array(o.length),l):null,tangent:i!=null?en(i,new Float32Array(i.length),l):null},t.getOriginPoint(r),{geographic:!t.isGeoreferenced})}function sn(n,t,e){if(e!=null&&e.useTransform){const{position:r,normal:a,tangent:o}=n,{x:i,y:l,z:c}=t,s=E(i,l,c??0);return{vertexAttributes:{position:r,normal:a,tangent:o},vertexSpace:e.geographic??1?new rn({origin:s}):new tn({origin:s}),transform:new an}}return{vertexAttributes:w(n,t,e),vertexSpace:new on,transform:null}}function j(n,t,e){return b(t.spatialReference,e)?hn(n,t,e):T(n,t,e)}function ln(n,t,e,r,a){if(!t.isRelative)return j(n,r,a);const{spatialReference:o}=r,i=M(n,t,e,o);return r.equals(t.getOriginPoint(o))?T(i,r,a):j(i,r,a)}function cn({positions:n,transform:t,vertexSpace:e,inSpatialReference:r,outSpatialReference:a,outPositions:o,local:i}){const l=e.isRelative?e.origin:x,c=e.isRelative?(t==null?void 0:t.localMatrix)??h:h;if(e.isGeoreferenced){const u=o??F(n.length);if(W(c,h)?B(u,n):m(u,n,c),!K(l,x)){const[G,N,P]=l;for(let p=0;p<u.length;p+=3)u[p]+=G,u[p+1]+=N,u[p+2]+=P}return v(u,r,0,u,a,0,u.length/3),u}const s=$(r),A=!i&&L(r,s)?s:r;d(r,l,f,A),q(f,f,c);const g=o??F(n.length);return m(g,n,f),v(g,A,0,g,a,0,g.length/3),g}function un(n,t,e){const r=new Float64Array(n.position.length),a=n.position,o=t.x,i=t.y,l=t.z??0,c=R(e?e.unit:null,t.spatialReference);for(let s=0;s<a.length;s+=3)r[s]=a[s]*c+o,r[s+1]=a[s+1]*c+i,r[s+2]=a[s+2]*c+l;return{position:r,normal:n.normal,tangent:n.tangent}}function fn(n,t,e){const r=t.spatialReference,a=z(t,e,f),o=new Float64Array(n.position.length),i=gn(n.position,a,r,o),l=S(_,a);return{position:i,normal:pn(i,o,n.normal,l,r),tangent:mn(i,o,n.tangent,l,r)}}function gn(n,t,e,r){m(r,n,t);const a=new Float64Array(n.length);return H(r,a,e)}function pn(n,t,e,r,a){if(e==null)return null;const o=new Float32Array(e.length);return y(o,e,r),I(o,n,t,a,o),o}function mn(n,t,e,r,a){if(e==null)return null;const o=new Float32Array(e.length);y(o,e,r,4);for(let i=3;i<o.length;i+=4)o[i]=e[i];return J(o,n,t,a,o),o}function T(n,t,e){const r=new Float64Array(n.position.length),a=n.position,o=t.x,i=t.y,l=t.z??0,c=R(e?e.unit:null,t.spatialReference);for(let s=0;s<a.length;s+=3)r[s]=(a[s]-o)/c,r[s+1]=(a[s+1]-i)/c,r[s+2]=(a[s+2]-l)/c;return{position:r,normal:n.normal,tangent:n.tangent}}function hn(n,t,e){const r=t.spatialReference;z(t,e,f);const a=Q(Rn,f),o=new Float64Array(n.position.length),i=yn(n.position,r,a,o),l=S(_,a);return{position:i,normal:jn(n.normal,n.position,o,r,l),tangent:wn(n.tangent,n.position,o,r,l)}}function z(n,t,e){d(n.spatialReference,[n.x,n.y,n.z??0],e,$(n.spatialReference));const r=R(t?t.unit:null,n.spatialReference);return D(e,e,[r,r,r]),e}function yn(n,t,e,r){const a=U(n,t,r),o=new Float64Array(a.length);return m(o,a,e),o}function jn(n,t,e,r,a){if(n==null)return null;const o=V(n,t,e,r,new Float32Array(n.length));return y(o,o,a),o}function wn(n,t,e,r,a){if(n==null)return null;const o=X(n,t,e,r,new Float32Array(n.length));return y(o,o,a,4),o}function R(n,t){if(n==null)return 1;const e=Y(t);return 1/Z(e,"meters",n)}const f=O(),Rn=O(),_=k(),dn=Object.freeze(Object.defineProperty({__proto__:null,georeference:w,georeferenceApplyTransform:M,georeferenceByTransform:sn,project:cn,ungeoreference:j,ungeoreferenceByTransform:ln},Symbol.toStringTag,{value:"Module"}));export{j as D,ln as E,cn as I,w as O,M as T,dn as g,$n as o,sn as q,b as r};
