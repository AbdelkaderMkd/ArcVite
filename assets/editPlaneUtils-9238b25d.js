import{cn as X,rU as fe,rV as Qe,rW as et,dd as b,er as _e,rw as se,jc as N,pt as Fe,ne as O,eV as ke,eU as ue,rm as tt,rX as it,gp as xe,aX as ne,co as nt,bk as ot,rY as Ue,bg as We,es as rt,aC as st,rZ as at,bd as Le,nd as z,r_ as lt,cO as pt,r$ as ct,aA as s,aB as l,aD as E,cs as ht,cu as de,s0 as oe,fK as re,fO as ut,aM as A,az as G,aW as dt,c8 as gt,s1 as J,s2 as ge,lY as yt,c7 as te,bZ as mt,s3 as vt,fN as ft,s4 as _t,fR as xt,j$ as we,hX as wt,nu as Tt,c0 as bt,k8 as Te,jJ as Ae,j_ as Ne,nj as Ot,e9 as Mt,jd as B,s5 as be,jq as Oe,s6 as Me,pw as je,d9 as U,pl as q,re as Se,s7 as St,s8 as Vt,fH as It,n5 as ae,n6 as Ve,nf as T,po as Ie,rx as $t,f1 as le}from"./index-80114339.js";import{m as I,U as j,r as $e,s as Ce}from"./getDefaultUnitForView-0be39faa.js";import{simplify as Ct,distance as Pt}from"./geometryEngine-8731a58f.js";import{l as Rt,d as pe,C as Gt}from"./dragEventPipeline-abaf6ee1.js";import{t as Y,p as Et,s as ce,d as zt,a as K}from"./automaticLengthMeasurementUtils-a1df5c43.js";import{o as Pe}from"./automaticAreaMeasurementUtils-70de9f96.js";import{r as Re}from"./dehydratedFeatureComparison-ba7e0833.js";import{w as Dt,_ as Zt,p as Ht,l as Ft,t as kt,a as Ut,s as Wt,c as Lt}from"./EditGeometryOperations-78581fd1.js";import{e as Ge}from"./SnappingContext-b1b2b57a.js";import{p as At,f as Nt}from"./SnappingOperation-4c914a06.js";function ie(t,e,i=null){return i!=null?[t,e,i]:[t,e]}function m(t,e,i=null){return i!=null?{x:t,y:e,z:i}:{x:t,y:e}}let Ye=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(i=>this.mapToLocal(i)).filter(ne)}get doUnnormalization(){return!1}};class jt extends Ye{constructor(e,i,n=null){super(i),this._defaultZ=n,this.transform=fe(),this.transformInv=fe(),this.transform=Qe(e),et(this.transformInv,this.transform)}makeMapPoint(e,i){return ie(e,i,this._defaultZ)}mapToLocal(e){return m(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return ie(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}}let Yt=class extends Ye{constructor(e,i){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=b(),this.tangentFrameUpWS=b(),this.tangentFrameRightWS=b(),this.tangentFrameForwardWS=b(),this.localFrameRightWS=b(),this.localFrameUpWS=b(),this.worldToLocalTransform=_e(),this.localToWorldTransform=_e(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=i,this.defaultZ=i.hasZ?i.z:null;const n=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,se.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,se.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,se.Z,this.tangentFrameForwardWS);const o=b();N(o,this.tangentFrameForwardWS,Fe(n,this.tangentFrameForwardWS)),O(this.localFrameRightWS,n,o),ke(this.localFrameRightWS,this.localFrameRightWS),ue(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),tt(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),it(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,i){return ie(e,i,this.defaultZ)}mapToLocal(e){const i=b();this.view.renderCoordsHelper.toRenderCoords(new X({x:e[0],y:e[1],spatialReference:this.spatialReference}),i),xe(i,i,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference);return n!=null?m(n.x/this.scale,n.y/this.scale):null}localToMap(e){const i=b();this.view.renderCoordsHelper.toRenderCoords(new X({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),i),xe(i,i,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference);return n!=null?ie(n.x,n.y,this.defaultZ):null}};function Ee(t,e){if(t.type==="2d")return new jt(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if(t.type==="3d"){const i=e.length>2?new X({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new X({x:e[0],y:e[1],spatialReference:t.spatialReference});return new Yt(t,i)}return null}function F(t,e){const i=new X({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(i.z=t[2]),i}function qt(t,e){return new nt({points:t,spatialReference:e})}function ze(t,e,i){const n=new ot({paths:t,spatialReference:e});return i&&Ue(n),n}function k(t,e,i,n=!0){const o=We(t);o.forEach(p=>{const a=p[0],c=p[p.length-1];rt(a,c)&&p.length!==1||p.push(p[0])});let r=new st({rings:o,spatialReference:e});return r.rings.forEach(p=>{at(p,!1,!1)||p.reverse()}),i&&Ue(r),n&&r.isSelfIntersecting&&Le(e)&&(r=Ct(r)),r}function De(t,e,i){const n=e.mapToLocalMultiple(t),o=[],r={x:n[0].x,y:n[0].y},p={x:n[1].x,y:n[1].y},a=Math.round(p.x-r.x),c=Math.round(p.y-r.y),g=Math.max(Math.abs(a),Math.abs(c));if(i){const u={x:r.x+g,y:r.y+g},y={x:r.x-g,y:r.y-g};o.push(m(u.x,y.y),m(y.x,y.y),m(y.x,u.y),m(u.x,u.y))}else{const u={x:a>0?r.x+g:r.x-g,y:c>0?r.y+g:r.y-g};o.push(m(r.x,r.y),m(u.x,r.y),m(u.x,u.y),m(r.x,u.y))}return qe(k([o.map(u=>e.localToMap(u)).filter(ne)],e.spatialReference,e.doUnnormalization,!0),o,e)}function Bt(t,e,i){let n=e.mapToLocalMultiple(t);if(n.length===1){const c=n[0];n=[m(c.x-48,c.y+48),m(c.x+48,c.y-48),m(c.x+48,c.y-48),m(c.x-48,c.y+48)]}const o=[],r={x:n[0].x,y:n[0].y},p={x:n[1].x,y:n[1].y};if(i){const a=Math.round(p.x-r.x),c=Math.round(p.y-r.y);o.push(m(r.x-a,r.y-c),m(p.x,r.y-c),m(p.x,p.y),m(r.x-a,p.y))}else o.push(m(r.x,r.y),m(p.x,r.y),m(p.x,p.y),m(r.x,p.y));return qe(k([o.map(a=>e.localToMap(a)).filter(ne)],e.spatialReference,e.doUnnormalization,!0),o,e)}function qe(t,e,i){const n=Q(e[3],e[2],i),o=Q(e[1],e[2],i),r=Q(e[0],e[1],i),p=Q(e[0],e[3],i);return{geometry:t,midpoints:n!=null&&o!=null&&r!=null&&p!=null?{top:n,right:o,bottom:r,left:p}:null}}function Q(t,e,i){W[0]=t.x,W[1]=t.y,W[2]=0,L[0]=e.x,L[1]=e.y,L[2]=0,z(W,W,L,.5),ee.x=W[0],ee.y=L[1],ee.z=L[2];const n=i.localToMap(ee);return n!=null?F(n,i.spatialReference):null}const ee=m(0,0,0),W=b(),L=b();function Ze(t,e,i,n){const o=e.mapToLocalMultiple(t);let r=null,p=null;if(i)r=o[0],p=o[1];else{const _=o[0],x=o[1],w=Math.round(x.x-_.x),M=Math.round(x.y-_.y),S=Math.max(Math.abs(w),Math.abs(M));r=m(w>0?_.x+S/2:_.x-S/2,M>0?_.y+S/2:_.y-S/2),p=m(Math.abs(w)>Math.abs(M)?r.x-S/2:r.x,Math.abs(w)>Math.abs(M)?r.y:r.y-S/2)}const a=e.localToMap(r),c=e.localToMap(p);if(a==null||c==null)return null;e.doUnnormalization&&lt([[a,c]],e.spatialReference);const g=F(a,e.spatialReference),u=F(c,e.spatialReference),y=pt(e.spatialReference);let v=0;if(Le(e.spatialReference))v=y*Pt(g,u,null);else{const _=r.x-p.x,x=r.y-p.y;v=y*Math.sqrt(_*_+x*x)*(n||1)}const h=new ct({center:g,radius:v,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:k(h.rings,h.spatialReference,!1),center:g,edge:u}}function Xt(t,e,i){const n=e.mapToLocalMultiple(t),o=n[0],r=n[1],p=Math.round(r.x-o.x),a=Math.round(r.y-o.y),c=m(i?o.x:o.x+p/2,i?o.y:o.y+a/2),g=i?p:p/2,u=i?a:a/2,y=60,v=[],h=2*Math.PI/y;function _($){const Je=Math.cos($),Ke=Math.sin($);return m(g*Je+c.x,u*Ke+c.y)}for(let $=0;$<y;$++)v.push(_($*h));v.push(v[0]);const{spatialReference:x,doUnnormalization:w}=e,M=k([v.map($=>e.localToMap($)).filter(ne)],x,w,!1),S=e.localToMap(_(Math.PI/2)),ye=e.localToMap(_(0)),me=e.localToMap(_(-Math.PI/2)),ve=e.localToMap(_(Math.PI));return{geometry:M,midpoints:S!=null&&ye!=null&&me!=null&&ve!=null?{top:F(S,x),right:F(ye,x),bottom:F(me,x),left:F(ve,x)}:null}}let D=class extends Y{constructor(t){super(t),this.type="draw-point"}};s([l()],D.prototype,"type",void 0),s([l()],D.prototype,"elevation",void 0),s([l()],D.prototype,"viewType",void 0),s([l()],D.prototype,"helpMessage",void 0),D=s([E("esri.views.interactive.tooltip.DrawPointTooltipInfo")],D);let C=class extends Y{constructor(t){super(t),this.type="draw-polyline",this.totalLength=I}};s([l()],C.prototype,"type",void 0),s([l()],C.prototype,"elevation",void 0),s([l()],C.prototype,"totalLength",void 0),s([l()],C.prototype,"viewType",void 0),s([l()],C.prototype,"helpMessage",void 0),C=s([E("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],C);let P=class extends Y{constructor(t){super(t),this.type="draw-polygon",this.area=j}};s([l()],P.prototype,"type",void 0),s([l()],P.prototype,"elevation",void 0),s([l()],P.prototype,"area",void 0),s([l()],P.prototype,"viewType",void 0),s([l()],P.prototype,"helpMessage",void 0),P=s([E("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],P);let Z=class extends Y{constructor(e){super(e),this.type="draw-mesh"}};s([l()],Z.prototype,"type",void 0),s([l()],Z.prototype,"elevation",void 0),s([l()],Z.prototype,"viewType",void 0),s([l()],Z.prototype,"helpMessage",void 0),Z=s([E("esri.views.interactive.tooltip.DrawMeshTooltipInfo")],Z);let H=class extends Y{constructor(t){super(t),this.type="draw-rectangle",this.xSize=I,this.ySize=I,this.area=j}};s([l()],H.prototype,"type",void 0),s([l()],H.prototype,"xSize",void 0),s([l()],H.prototype,"ySize",void 0),s([l()],H.prototype,"area",void 0),H=s([E("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],H);let R=class extends Y{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=j}};s([l()],R.prototype,"type",void 0),s([l()],R.prototype,"radius",void 0),s([l()],R.prototype,"xSize",void 0),s([l()],R.prototype,"ySize",void 0),s([l()],R.prototype,"area",void 0),R=s([E("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],R);class Jt{constructor(){this.regularVertices=null,this.activeVertex=null,this.full=null,this.outline=null,this.circle=null,this.rectangle=null}}let d=class extends ht(de.EventedMixin(Rt)){constructor(e){super(e),this._graphic=null,this._createOperationGeometry=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.labelOptions=new oe,this.geometryToPlace=null,this.mode=null,this.snappingManager=null,this.snapToScene=!1,this.tooltip=null,this.tooltipOptions=new re}initialize(){this.internalGraphicsLayer=new ut({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",e=>this.onVertexAdd(e)),this.drawOperation.on("vertex-remove",e=>this.onVertexRemove(e)),this.drawOperation.on("vertex-update",e=>this.onVertexUpdate(e)),this.drawOperation.on("cursor-update",e=>this.onCursorUpdate(e)),this.drawOperation.on("complete",e=>this.onComplete(e)),A(()=>this.tooltipOptions.enabled,e=>{this.tooltip=e?new zt({view:this.view,info:this._tooltipInfo}):G(this.tooltip)},te),A(()=>this._tooltipInfo,e=>{this.tooltip!=null&&(this.tooltip.info=e)},te)]),this.finishToolCreation()}destroy(){this.drawOperation=G(this.drawOperation),this.tooltip=G(this.tooltip),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=G(this.internalGraphicsLayer),this._set("view",null)}get _defaultElevation(){return $e(this.defaultZ,"meters")}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),this._graphic!=null&&(this._graphic.symbol=e)}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_destroyAllVisualisations(){this.handles.remove(V.outline),this.handles.remove(V.regularVertices),this.handles.remove(V.activeVertex),this.handles.remove(he)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this._updateGraphicGeometry(this._graphic,e),this._graphic;const i=this._graphic=new dt({...this.graphicProperties,symbol:this.graphicSymbol});return this._updateGraphicGeometry(i,e),this.internalGraphicsLayer.add(i),this.handles.add(this.initializeGraphic(i)),this.notifyChange("graphic"),this.handles.add(gt(()=>{this.internalGraphicsLayer.remove(i),G(i),this._graphic===i&&(this._graphic=null)}),he),i}_updateGraphicGeometry(e,i){e.geometry=i}_getCreateOperationGeometry(e={operationComplete:!1}){var _;const{drawOperation:i}=this;if(i==null||i.numVertices===0)return null;const{coordinateHelper:n,view:o}=i,r=i.stagedVertex,p=i.committedVertices,a=p.slice(),c=r!=null;c&&a.push(n.pointToArray(r));const g=c?n.pointToArray(r):p.splice(-1)[0],u=a.length,y=o.spatialReference,v=o.type==="3d"&&o.viewingMode==="global",h=new Jt;switch(this.geometryType){case"point":case"mesh":h.regularVertices=p,h.activeVertex=g,h.full=n.arrayToPoint(a[0]);break;case"multipoint":h.regularVertices=p,h.activeVertex=g,u>0&&(h.full=qt(a,y));break;case"polyline":h.regularVertices=p,h.activeVertex=g,u>0&&(h.full=ze([a],y,v));break;case"polygon":h.regularVertices=p,h.activeVertex=g,u>0&&(h.full=k([a],y,v,!0));break;case"circle":if(u>0){const x=Ee(o,a[0]);if(u===1&&e.operationComplete){const w=a[0],M=x.makeMapPoint(w[0]+He*o.resolution,w[1]);h.circle=Ze([w,M],x,!0),h.full=h.circle!=null?h.circle.geometry:null}else u===2&&(this.forceUniformSize?(h.circle=Ze(a,x,this.centered),h.full=h.circle!=null?h.circle.geometry:null):(h.rectangle=Xt(a,x,this.centered),h.full=h.rectangle.geometry))}break;case"rectangle":if(u>0){const x=Ee(o,a[0]);if(u===1&&e.operationComplete){const w=a[0],M=x.makeMapPoint(w[0]+He*o.resolution,w[1]);h.rectangle=De([w,M],x,!0),h.full=h.rectangle.geometry}else u===2&&(h.rectangle=this.forceUniformSize?De(a,x,this.centered):Bt(a,x,this.centered),h.full=h.rectangle.geometry)}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":h.outline=u>1?ze([a],y,v):null;break;case"polygon":h.outline=u>1?k([a],y,v):null;break;case"circle":case"rectangle":h.outline=((_=h.full)==null?void 0:_.type)==="polygon"?k(h.full.rings,y,v):null}return h}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let i=null;if(this.drawOperation.isCompleted){const n=this._getCreateOperationGeometry({operationComplete:!0});n!=null&&(i=this._createOrUpdateGraphic(n.full).clone())}this._createOperationGeometry=null,this.emit("complete",{graphic:i,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e!=null?(e.outline!=null?this.handles.add(this.onOutlineChanged(e.outline),V.outline):this.handles.remove(V.outline),e.regularVertices!=null?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),V.regularVertices):this.handles.remove(V.regularVertices),e.activeVertex!=null?this.handles.add(this.onActiveVertexChanged(e.activeVertex),V.activeVertex):this.handles.remove(V.activeVertex),e.full!=null?this._createOrUpdateGraphic(e.full):this.handles.remove(he)):this._destroyAllVisualisations()}get _tooltipInfo(){const{drawOperation:e}=this;if(!e)return null;switch(this.geometryType){case"point":return this._drawPointTooltipInfo;case"polyline":return this._drawPolylineTooltipInfo;case"polygon":return this._drawPolygonTooltipInfo;case"rectangle":return this._drawRectangleTooltipInfo;case"circle":return this._drawCircleTooltipInfo;case"mesh":return this._drawMeshTooltipInfo;default:return null}}get _drawPointTooltipInfo(){const{view:e,graphic:i}=this,n=i==null?void 0:i.geometry;return(n==null?void 0:n.type)!=="point"||e.type==="2d"&&this.defaultZ===0?null:new D({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:e.type,helpMessage:J("point",n,e)})}get _drawPolylineTooltipInfo(){const e=this._createOperationGeometry,i=e!=null?e.full:null;if((i==null?void 0:i.type)!=="polyline")return null;const n=Et(i,this._elevationMode),{view:o}=this;return new C({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,totalLength:n??I,viewType:o.type,helpMessage:J("polyline",i,o)})}get _drawPolygonTooltipInfo(){const e=this._createOperationGeometry,i=e!=null?e.full:null;if((i==null?void 0:i.type)!=="polygon")return null;const n=Pe(i,this._elevationMode),{view:o}=this;return new P({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,area:n??j,viewType:o.type,helpMessage:J("polygon",i,o)})}get _drawMeshTooltipInfo(){const{view:e,graphic:i}=this,n=i==null?void 0:i.geometry;return(n==null?void 0:n.type)!=="mesh"||e.type==="2d"&&this.defaultZ===0?null:new Z({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:e.type,helpMessage:J("mesh",n,e)})}get _drawRectangleTooltipInfo(){return this.drawOperation==null?null:new H({tooltipOptions:this.tooltipOptions,xSize:this._xSize??I,ySize:this._ySize??I,area:this._fullGeometryArea??j})}get _drawCircleTooltipInfo(){if(this.drawOperation==null)return null;const e=this.forceUniformSize;return new R({tooltipOptions:this.tooltipOptions,radius:e?this._circleRadius??I:null,xSize:e?null:this._xSize??I,ySize:e?null:this._ySize??I,area:this._fullGeometryArea??j})}get _circleRadius(){const e=this._createOperationGeometry;return e!=null&&e.circle!=null&&e.circle.center!=null&&e.circle.edge!=null?ce(e.circle.center,e.circle.edge,this._elevationMode):null}get _xSize(){const e=this._createOperationGeometry;if((e==null?void 0:e.rectangle)==null)return null;const{midpoints:i}=e.rectangle;return i!=null?ce(i.left,i.right,this._elevationMode):null}get _ySize(){const e=this._createOperationGeometry;if((e==null?void 0:e.rectangle)==null)return null;const{midpoints:i}=e.rectangle;return i!=null?ce(i.top,i.bottom,this._elevationMode):null}get _fullGeometryArea(){const e=this._createOperationGeometry,i=e!=null?e.full:null;return(i==null?void 0:i.type)!=="polygon"?null:Pe(i,this._elevationMode)}get _elevationTooltipDetail(){return{mode:this.drawOperation.elevationInfo.mode,...this._vertexTooltipElevation}}get _vertexTooltipElevation(){const{tooltipOptions:e,view:i,drawOperation:n}=this;if(n==null)return this._defaultElevation;const o=n.stagedVertex??n.lastVertex;if(o==null||i.type==="2d")return this._defaultElevation;const r={mode:e.elevation.mode,offset:0},p=(ge(i,o,n.elevationInfo,r)??0)*yt(o.spatialReference);return $e(p,"meters")}get _elevationMode(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}};s([l()],d.prototype,"_createOperationGeometry",void 0),s([l()],d.prototype,"_defaultElevation",null),s([l({value:!0})],d.prototype,"centered",null),s([l({nonNullable:!0})],d.prototype,"defaultZ",void 0),s([l()],d.prototype,"drawOperation",void 0),s([l({value:!0})],d.prototype,"enabled",null),s([l({value:!0})],d.prototype,"forceUniformSize",null),s([l({constructOnly:!0})],d.prototype,"geometryType",void 0),s([l()],d.prototype,"graphic",null),s([l({constructOnly:!0})],d.prototype,"graphicProperties",void 0),s([l()],d.prototype,"graphicSymbol",null),s([l({constructOnly:!0})],d.prototype,"hasZ",void 0),s([l({constructOnly:!0,type:oe})],d.prototype,"labelOptions",void 0),s([l({constructOnly:!0})],d.prototype,"geometryToPlace",void 0),s([l({constructOnly:!0})],d.prototype,"mode",void 0),s([l()],d.prototype,"snappingManager",void 0),s([l()],d.prototype,"snapToScene",void 0),s([l()],d.prototype,"tooltip",void 0),s([l({constructOnly:!0,type:re})],d.prototype,"tooltipOptions",void 0),s([l({readOnly:!0})],d.prototype,"type",void 0),s([l({readOnly:!0})],d.prototype,"updating",null),s([l({constructOnly:!0,nonNullable:!0})],d.prototype,"view",void 0),s([l()],d.prototype,"_tooltipInfo",null),s([l()],d.prototype,"_drawPointTooltipInfo",null),s([l()],d.prototype,"_drawPolylineTooltipInfo",null),s([l()],d.prototype,"_drawPolygonTooltipInfo",null),s([l()],d.prototype,"_drawMeshTooltipInfo",null),s([l()],d.prototype,"_drawRectangleTooltipInfo",null),s([l()],d.prototype,"_drawCircleTooltipInfo",null),s([l()],d.prototype,"_circleRadius",null),s([l()],d.prototype,"_xSize",null),s([l()],d.prototype,"_ySize",null),s([l()],d.prototype,"_fullGeometryArea",null),s([l()],d.prototype,"_elevationTooltipDetail",null),s([l()],d.prototype,"_vertexTooltipElevation",null),s([l()],d.prototype,"_elevationMode",null),d=s([E("esri.views.draw.DrawGraphicTool")],d);const he="create-operation-graphic",V={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function vi(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const He=48,Be="click";class Kt{constructor({grabbableForEvent:e}){this.events=new de,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,i){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}let f=class extends de.EventedMixin(mt){constructor(t){super(t),this._createOperationCompleted=!1,this._pointerDownStates=new Set,this._stagedScreenPoint=null,this._stagedPointerType=null,this.isDraped=!0,this.labelOptions=new oe,this.tooltipOptions=new re,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.lastVertex=null,t.elevationInfo==null&&(this.elevationInfo=vt(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,i=e.spatialReference,n="viewingMode"in e.state?e.state.viewingMode:ft.Local,o=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=Dt(this.hasZ,this.hasM,i),this._editGeometryOperations=new Zt(new Ht(o,this.coordinateHelper)),this._snappingOperation=new At({view:e,constrainResult:a=>{var c;return a==null?a:(c=this._getEffectiveDrawSurface())==null?void 0:c.constrainZ(a)}}),this.addHandles([A(()=>this.stagedVertex,a=>{a!=null&&this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(a)}],operation:"apply",type:"vertex-update"})},{sync:!0,equals:(a,c)=>Tt(a,c,Re)}),A(()=>this.view.viewpoint,(a,c)=>{a&&c&&bt(a,c)&&this._onViewpointChange()})]),this._activeComponent=new Ft(i,n),this._editGeometryOperations.data.components.push(this._activeComponent);const r=this.segmentLabels;r!=null&&(r.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles([A(()=>this.labelOptions.enabled,a=>{r.visible=a},te),this.on("cursor-update",()=>{const a=this.stagedVertex;r.stagedVertex=a!=null?this.coordinateHelper.pointToVector(a):null})])),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],a=>{const c=a.vertices.map(v=>({componentIndex:0,vertexIndex:v.index,coordinates:this.coordinateHelper.vectorToArray(v.pos)})),g=c.map(v=>v.coordinates);switch(a.type){case"vertex-add":this.emit(a.type,{...a,added:g,vertices:c});break;case"vertex-update":this.emit(a.type,{...a,updated:g,vertices:c});break;case"vertex-remove":this.emit(a.type,{...a,removed:g,vertices:c})}const u=this._activeComponent.getLastVertex(),y=u!=null?this.coordinateHelper.vectorToDehydratedPoint(u.pos):null;y!=null&&this.lastVertex!=null&&Re(this.lastVertex,y)||(this.lastVertex=y)}));const p=this._manipulator=new Kt({grabbableForEvent:a=>this.drawingMode!=="click"||a.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(p),p.grabbable=t!=="point",this.addHandles([this._createManipulatorDragPipeline(p),p.events.on("immediate-click",a=>this._onImmediateClick(a)),p.events.on("immediate-double-click",a=>this._onImmediateDoubleClick(a)),A(()=>({cursor:this.cursor,loading:this.loading}),({cursor:a,loading:c})=>{p.cursor=c?"progress":a},te)]),_t(this,()=>{const a=this.view.inputManager.latestPointerType??"mouse",c=this._getSnappingContext(a);this.snappingManager!=null&&this.updatingHandles.addPromise(we(this._snappingOperation.resnap(this.snappingManager,c)))})}destroy(){G(this.segmentLabels),G(this._snappingOperation),this._editGeometryOperations=G(this._editGeometryOperations)}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._getEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}set drawingMode(t){this._set("drawingMode",t??Be)}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return this.stagedVertex!=null?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get stagedVertex(){return this._snappingOperation.stagedPoint}set stagedVertex(t){this._snappingOperation.stagedPoint=We(t)}get updating(){return this.updatingHandles.updating}get vertices(){const t=this.committedVertices;return this.stagedVertex!=null&&t.push(this.coordinateHelper.pointToArray(this.stagedVertex)),t}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingOperation.abort(),this.stagedVertex!=null){const{stagedVertex:t}=this;this.stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}}complete(t){const e=t&&t.aborted||!1;this._snappingOperation.abort(),this.snappingManager!=null&&this.snappingManager.doneSnapping(),this.geometryType==="segment"||this.geometryType==="point"?this.commitStagedVertex():this.stagedVertex=null;const i=this.geometryType==="multipoint"&&this.numVertices===0||this.geometryType==="polyline"&&this.numVertices<2||this.geometryType==="polygon"&&this.numVertices<3;this._createOperationCompleted=!i,(this.isCompleted||e)&&this.emit("complete",{vertices:this.vertices.map((n,o)=>({componentIndex:0,vertexIndex:o,coordinates:n})),aborted:e,type:"complete"})}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(t){const e=this._activeComponent;if(this.geometryType==="polygon"&&e.vertices.length>2){if(this._vertexWithinPointerDistance(e.vertices[0].pos,t))return 0;if(this._vertexWithinPointerDistance(e.vertices[e.vertices.length-1].pos,t))return e.vertices.length-1}return null}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return pe(t,(e,i,n,o)=>{const r=o==="touch"&&this._snappingEnabled;if(this.isCompleted||!r)return;const{snappingStep:p,cancelSnapping:a}=Nt({predicate:()=>r,snappingManager:this.snappingManager,snappingContext:new Ge({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:o,visualizer:this.snappingVisualizer}),updatingHandles:this.updatingHandles,useZ:!this._requiresScenePoint});n=n.next(c=>(r&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),c)).next(a),i.next(this._screenToMapDragEventStep()).next(c=>(c.action==="start"&&(this.stagedVertex=c.mapStart,(this.geometryType==="segment"||r&&this.numVertices===0)&&this.commitStagedVertex()),c)).next(Gt(this.view,this.elevationInfo)).next(...p).next(c=>(r&&(this.stagedVertex=c.mapEnd,c.action==="end"&&this.commitStagedVertex()),c)).next(c=>(c.action==="end"&&(this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),c))})}_createManipulatorDragPipelineFreehand(t){return pe(t,(e,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this.stagedVertex==null&&(this.stagedVertex=n.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this.stagedVertex=n.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return n})})}_createManipulatorDragPipelineHybrid(t){return pe(t,(e,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this.stagedVertex==null&&(this.stagedVertex=n.mapStart),this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this.stagedVertex=n.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return n})})}get _drawAtFixedElevation(){return(this.geometryType==="segment"||this.geometryType==="polygon")&&this.numCommittedVertices>0}_getEffectiveDrawSurface(){if(this.elevationDrawSurface==null)return this.drawSurface;if(!this.coordinateHelper.hasZ())return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let t=this.defaultZ,e=!1;return this.elevationInfo!=null&&this.elevationInfo.mode==="absolute-height"&&(e=!0),this.snapToSceneEnabled!=null&&(e=this.snapToSceneEnabled),this.elevationInfo!=null&&this.elevationInfo.mode==="on-the-ground"&&(e=!1),this._drawAtFixedElevation&&(t=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),e=!1),e?this.drawSurface:(this.elevationDrawSurface.defaultZ=t,this.elevationDrawSurface)}_mapToScreen(t){var e;return(e=this._getEffectiveDrawSurface())==null?void 0:e.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&(this.stagedVertex=t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging)return;const e=this._activeComponent;if(this._closeOnClickVertexIndex(t.screenPoint)!=null)return t.stopPropagation(),void this.complete();const i=this._screenToMap(t.screenPoint);if(i!=null)switch(this.drawingMode){case"freehand":this.geometryType==="point"&&(this.stagedVertex!=null?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),this.complete());break;case"click":case"hybrid":this._snappingOperation.abort(),this.stagedVertex!=null?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),(this.geometryType==="point"||this.geometryType==="segment"&&e.vertices.length===2||this.geometryType==="segment"&&this.drawingMode==="hybrid"&&e.vertices.length===1)&&this.complete()}t.stopPropagation()}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){const e=xt(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType;const i=this._snappingOperation,n=this._manipulator;n.dragging||this._pointerDownStates.has(t.pointerId)||n.grabbing||!n.interactive?i.abort():(t.stopPropagation(),this._updateStagedVertexOnPointerMove(e,t.pointerType))}_onViewpointChange(){const t=this._manipulator;this._stagedScreenPoint&&!t.dragging&&!t.grabbing&&t.interactive?this._updateStagedVertexOnPointerMove(this._stagedScreenPoint,this._stagedPointerType??"mouse"):this._snappingOperation.abort()}_updateStagedVertexOnPointerMove(t,e){var c;const i=this._snappingOperation,n=this._closeOnClickVertexIndex(t);if(n!=null)return this._closeOnVertex(n),void i.abort();const o=this._screenToMap(t),r=this._requiresScenePoint?(c=this.drawSurface)==null?void 0:c.screenToMap(t):null;if(o==null)return this.cursor=null,void i.abort();this.cursor="crosshair";const p=this.snappingManager;if(p==null)return this.stagedVertex=o,void i.abort();const a=this._getSnappingContext(e);this.updatingHandles.addPromise(we(i.snap({point:o,scenePoint:r},p,a)))}_closeOnVertex(t){this.stagedVertex=null;const e={componentIndex:0,vertexIndex:t,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[t].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}_screenToMap(t){var e;return(e=this._getEffectiveDrawSurface())==null?void 0:e.screenToMap(t)}_screenToMapDragEventStep(){let t=null;return e=>{if(e.action==="start"&&(t=this._screenToMap(e.screenStart)),t==null)return null;const i=this._screenToMap(e.screenEnd);return i!=null?{...e,mapStart:t,mapEnd:i}:null}}_vertexWithinPointerDistance(t,e){const n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return n!=null&&Qt(n,e,25)}_getSnappingContext(t){const e=this._drawAtFixedElevation?wt(this.elevationDrawSurface,({defaultZ:i})=>i):null;return new Ge({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,visualizer:this.snappingVisualizer,selfSnappingZ:e!=null?{value:e,elevationInfo:this.elevationInfo}:null})}};function Qt(t,e,i){const n=t.x-e.x,o=t.y-e.y;return n*n+o*o<=i}s([l()],f.prototype,"_snappingEnabled",null),s([l()],f.prototype,"defaultZ",void 0),s([l()],f.prototype,"isDraped",void 0),s([l({value:Be})],f.prototype,"drawingMode",null),s([l({constructOnly:!0})],f.prototype,"elevationDrawSurface",void 0),s([l({constructOnly:!0})],f.prototype,"elevationInfo",void 0),s([l({constructOnly:!0,type:oe})],f.prototype,"labelOptions",void 0),s([l({constructOnly:!0,type:re})],f.prototype,"tooltipOptions",void 0),s([l({constructOnly:!0})],f.prototype,"geometryType",void 0),s([l({constructOnly:!0})],f.prototype,"hasM",void 0),s([l({constructOnly:!0})],f.prototype,"hasZ",void 0),s([l()],f.prototype,"cursor",void 0),s([l()],f.prototype,"loading",void 0),s([l({constructOnly:!0})],f.prototype,"manipulators",void 0),s([l({constructOnly:!0})],f.prototype,"drawSurface",void 0),s([l({constructOnly:!0})],f.prototype,"segmentLabels",void 0),s([l({constructOnly:!0})],f.prototype,"snappingManager",void 0),s([l({constructOnly:!0})],f.prototype,"snappingVisualizer",void 0),s([l()],f.prototype,"snapToSceneEnabled",void 0),s([l()],f.prototype,"_snappingOperation",void 0),s([l()],f.prototype,"stagedVertex",null),s([l()],f.prototype,"lastVertex",void 0),s([l()],f.prototype,"updating",null),s([l({constructOnly:!0})],f.prototype,"view",void 0),f=s([E("esri.views.draw.DrawOperation")],f);class fi{constructor(e,i,n,o=null){this._elevationInfo=e,this.defaultZ=i,this._view=n,this._excludeGraphics=o}screenToMap(e){if(this.defaultZ!=null)return this._view.sceneIntersectionHelper.intersectElevationFromScreen(Te(e.x,e.y),this._elevationInfo,this.defaultZ,this._excludeGraphics);const i=this._view.sceneIntersectionHelper.intersectElevationFromScreen(Te(e.x,e.y),this._elevationInfo,0,this._excludeGraphics);return i!=null&&(i.z=void 0),i}mapToScreen(e){const i=Ae(e.x,e.y,ge(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(i)}constrainZ(e){const{defaultZ:i}=this;return i!=null&&e.z!==i&&((e=Ne(e)).z=i),e}}class _i{constructor(e,i,n=[]){this.view=e,this.elevationInfo=i,this.exclude=n}screenToMap(e){const i=this.view.toMap(e,{exclude:this.exclude});return i!=null&&(i.z=Ot(i,this.view,this.elevationInfo)),i}mapToScreen(e){let i=e;return this.elevationInfo!=null&&(i=Ae(e.x,e.y,ge(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(i)}constrainZ(e){return e}}class xi{constructor(e,i=!1,n=0){this.view=e,this.hasZ=i,this.defaultZ=n,this.mapToScreen=o=>e.toScreen(o),this.screenToMap=i?o=>{const r=e.toMap(o);return r.z=n,r}:o=>e.toMap(o)}constrainZ(e){const{defaultZ:i}=this;return this.hasZ&&e.z!==i&&((e=Ne(e)).z=i),e}}function wi(t,e){return Xe(t,e,!1)}function Ti(t,e){return Xe(t,e,!0)}function Xe(t,e,i){if(t instanceof kt){if(t.operation instanceof Ut)return ei(t.operation,e,i),!0;if(t.operation instanceof Wt)return ti(t.operation,e,i),!0;if(t.operation instanceof Lt)return ii(t.operation,e,i),!0}return!1}function ei(t,e,i=!1){const n=i?-1:1,o=Mt(n*t.dx,n*t.dy,n*t.dz);B(e.origin,e.origin,o)}function ti(t,e,i=!1){const n=i?-t.angle:t.angle;be(e.basis1,e.basis1,Oe,n),be(e.basis2,e.basis2,Oe,n)}function ii(t,e,i=!1){const n=i?1/t.factor1:t.factor1,o=i?1/t.factor2:t.factor2;N(e.basis1,e.basis1,n),N(e.basis2,e.basis2,o),Me(e.origin,e.origin,t.origin,t.axis1,n),Me(e.origin,e.origin,t.origin,t.axis2,o)}function bi(t,e,i,n){n||(n=je());const o=U(q.get(),t[1],-t[0]),r=U(q.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),p=U(q.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),a=q.get();e.components.forEach(u=>u.vertices.forEach(y=>{const v=y.pos;U(a,Se(t,v),Se(o,v)),St(r,r,a),Vt(p,p,a)}));const c=1e-6,g=U(q.get(),p[0]-r[0]<c?i/2:0,p[1]-r[1]<c?i/2:0);return It(r,r,g),ae(p,p,g),Ve(n.basis1,t,(p[0]-r[0])/2),Ve(n.basis2,o,(p[1]-r[1])/2),U(n.origin,r[0]*t[0]+r[1]*o[0],r[0]*t[1]+r[1]*o[1]),ae(n.origin,n.origin,n.basis1),ae(n.origin,n.origin,n.basis2),n}function Oi(t,e,i,n=0,o){o||(o=je()),e.toRenderCoords(t.origin,i,o.origin);const r=T.get();B(r,t.origin,t.basis1),B(r,r,t.basis2),e.toRenderCoords(r,i,r);const p=T.get();B(p,t.origin,t.basis1),O(p,p,t.basis2),e.toRenderCoords(p,i,p);const a=T.get();O(a,t.origin,t.basis1),O(a,a,t.basis2),e.toRenderCoords(a,i,a);const c=T.get();O(c,t.origin,t.basis1),B(c,c,t.basis2),e.toRenderCoords(c,i,c);const g=z(T.get(),r,p,.5);O(g,g,o.origin);const u=z(T.get(),a,c,.5);O(u,o.origin,u),z(o.basis1,g,u,.5);const y=z(T.get(),c,r,.5);O(y,y,o.origin);const v=z(T.get(),p,a,.5);O(v,o.origin,v),z(o.basis2,y,v,.5);const h=ue(T.get(),o.basis1,o.basis2),_=ue(h,h,o.basis1);return ke(_,_),N(o.basis2,_,Fe(o.basis2,_)),N(o.basis1,o.basis1,1+n/Ie(o.basis1)),N(o.basis2,o.basis2,1+n/Ie(o.basis2)),$t(o),o}function Mi(t,e,i,n){const o=T.get();O(o,O(o,t.origin,t.basis1),t.basis2);const r=T.get();le(r,o,t.basis1,2);const p=T.get();le(p,r,t.basis2,2);const a=T.get();le(a,o,t.basis2,2),o[2]=r[2]=p[2]=a[2]=e;const c=n?"on-the-ground":"absolute-height",g=Ce(K(o,r,i,c),K(a,p,i,c)),u=Ce(K(r,p,i,c),K(o,a,i,c));return u==null||g==null?null:[g,u]}export{d as E,wi as F,Oi as G,vi as H,f as I,Mi as M,Ti as S,bi as U,xi as c,_i as o,fi as r};
